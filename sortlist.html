<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>Login Page</title>
		<link rel="stylesheet" href="themes/Black_MC.min.css" />
		<link rel="stylesheet" href="themes/jquery.mobile.icons.min.css" />
		<link rel="stylesheet" href="jquerymobile/jquery.mobile.structure-1.4.2.min.css" />
        <link rel="stylesheet" href="css/tc_style.css" />
        <script src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
        <script src="js/jqm.page.params.js"></script> 
		<script src="jquerymobile/jquery-1.11.0.min.js"></script>
        <script src="jquerymobile/jquery.mobile-1.4.2.min.js"></script> 
	  	<script>
            function getCookie(cname)
            {
                var name = cname + "=";
                var ca = document.cookie.split(';');
                var cookie = ca[0].trim();
                for(var i=0; i<ca.length; i++) 
                  {
                  var c = ca[i].trim();
                  if (c.indexOf(name)==0) return c.substring(name.length,c.length);
                  }
                return "";
            }
            
            function checkCookie()
            {
                var userLoggedin=getCookie("isUserLoggedin");
                if (userLoggedin=="OK")
                {
                  alert("You are logged in");
                    // TODO: function for registered users
                }
                else 
                {
                    alert("Not logged in");
                    // TODO: function for guest users
                }
            }
            
            // Login check
            function isLoggedin()
            {   
                var logoutButton = document.getElementById("logoutButton");
                var loginButton = document.getElementById("loginButton");
                
                var login = getCookie("isUserLoggedin");
                
                if(login=="OK"){
                    return "true";
//                    logoutButton.style.visibility='visible';
//                    loginButton.style.visibility='hidden';
                }else{
                    return "false";
//                    logoutButton.style.visibility='hidden';
//                    loginButton.style.visibility='visible';
                }
            }
            
            // Erase a cookie
            function eraseCookie(name){
                var today = new Date();
                alert(document.cookie);
                document.cookie = name + '=';
                alert(document.cookie);
            }
            
            // Logout - erase a cookie
            function logout(url){
                eraseCookie('isUserLoggedin');
                goTo(url);
            }
        </script>
        
        <style>
		.videolistitem table
		{
			width:100%;
		}
		.videolistitem .tdimage
		{
			width:105px;
			
		}
		.videolistitem
		{
	border-bottom-width: 1px;
	border-bottom-style: solid;
	border-bottom-color: #555;		
	height:155px;	
		}
		.videolistitem:hover
		{
			opacity:0.4;
		}
		.videolistitemimage
		{
			
			
		}
		.videolistitemtext
		{
			margin-left:4px;
		}
		.videolistitemtitle
		{
			
			 
			 font-size:18px;
			 margin-bottom:6px;
			 
			 
			 
		}
		.videolistitemtitle a
		{
			text-decoration:none;
			
			
		}
		
		.videolistitemdesc
		{
			
			
			height:100px;
			font-size:15px;
		}
		.tc_header
			{
				background: -webkit-gradient(linear,center top,center bottom,from(#999), to(#444));
			}
			.tc_footer
			{
				background: -webkit-gradient(linear,center top,center bottom,from(#999), to(#444));
			}
		
		
		</style>
	</head>
	<body onload="isLoggedin()">
        <!--HEADER START -->
		<div data-role="header" data-position="fixed" class="tc_header">
			<a href="" class="ui-btn ui-shadow ui-corner-all ui-icon-arrow-l ui-btn-icon-notext" onclick="goBack()"/></a> 
			<h1 class="lh1" id="videoTitle"></h1>
			<!-- <a href="" class="ui-btn-right ui-btn ui-btn-inline ui-mini ui-corner-all ui-btn-icon-right ui-icon-gear" onclick="window.location.href ='UserSetting.html'"></a> -->
			<a href="#nav-panel" data-icon="bars" data-iconpos="notext">Menu</a>
      	</div>
        <div data-role="panel" data-position-fixed="true"  data-display="overlay" data-position="right"  data-theme="a" id="nav-panel" style="margin-top:44px;">
	        <ul data-role="listview">
	            <li data-icon="delete"><a href="#" data-rel="close" >Close Menu</a></li>
	            <li><a onclick="window.location.href ='UserSetting.html'">User Setting</a></li>
                <script>
                    if(isLoggedin() == "true"){
                        document.write("<li><a onclick='logout(\"videolist.html\")'>Logout</a></li>");
                    }else{
                        document.write("<li><a onclick='window.location.href =\"login.html\"'>Login</a></li>");
                    }
                </script>
	            <hr />
	            <li><a onclick="window.location.href ='sortlist.html'">Search</a></li>
	            <li><a onclick="window.location.href ='videolist.html'">Video List</a></li>
				<li><a onclick="window.location.href ='AboutUs.html'">About Us</a></li>
				<li><a onclick="window.location.href ='FAQ.html'">FAQ</a></li>
				<li><a onclick="window.location.href ='Feedback.html'">Feedback</a></li>
	        </ul>
       </div><!-- /panel -->
        <!--HEADER END -->

		<div data-role="content" data-theme="a">
			<div>				
				<label>Search</label>
				<!-- <select id = "myList">
				   <option value = "1" onclick="getData()">new release</option>
				   <option value = "2">popular</option>
				   <option value = "3">all</option>
				   <option value = "4">type4</option>
				</select> -->
				<input id="search" type="search" placeholder="Search Key Word" onkeydown="clearCounter()"><br />
			</div>
	 
			<div id="div1" style="display: ;">
				<div id="av"></div>
			</div>
			
			<div class="wrap captionfull" id="container" >
				<script type="text/javascript">
					function getvar()
					{
						var videolist = 'connect to db and then get list';
					}
					  $(document).bind("mobileinit", function() {
		        $.support.cors = true;
		        $.mobile.allowCrossDomainPages = true;
		    });

            // Listener that will invoke the onDeviceReady() function as soon as phonegap has loaded properly
		    document.addEventListener("deviceready", onDeviceReady, false);
			
            // Adding the back button listener
            function onDeviceReady() 
            {
		        navigator.splashscreen.hide();
		        document.addEventListener("backbutton", onBackClickEvent, false); 
		    }

	        function goTo(url)
            {
	            window.location.href=url+"";
	        }
            
            // Back button
            function goBack()
            {
                window.history.back();
            }
				
					var videoURL = [];
					var videoT = [];
					var videoD = [];
					var videoI = [];
					var mtaJSON;
					
					var searchValue = "";
					var ct = 0;
							
					var timer = setInterval(counterFunction,500);
							
					function counterFunction()
					{
						ct++;
						if(ct == 2)
						{
							sf();
						}
					}
					
					function clearCounter()
					{
						ct = 0;
					}
					
					function sf()
					{	
						document.getElementById("av").innerHTML="";	
						searchValue = document.getElementById("search").value;
						searchFunction();
					}
					
					function goVideoPlayer(videoid) {
					    location.href = "videoComment.html?id="+videoid;
					}//link to video player
					
					function trimByWord(sentence) {
var result = sentence;
var resultArray = result.split(" ");
if(resultArray.length > 15){
resultArray = resultArray.slice(0, 15);
result = resultArray.join(" ") + "â€¦";
}
return result;
}
					
				   	function searchFunction()
					{
						$(document).ready(function() {
								var xmlhttp;
								if (window.XMLHttpRequest)
								{
									// code for IE7+, Firefox, Chrome, Opera, Safari
									xmlhttp=new XMLHttpRequest();
								}
								else
								{
									// code for IE6, IE5
									xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
								}
							
								xmlhttp.open("GET","http://remoteriver.eicp.net/trailercollection/videoinfo.php",true);
								xmlhttp.send();
								var counter =0;
								var lengthInput = 0;
								var lengthTitle = 0;
								xmlhttp.onreadystatechange=function()
						  		{
						  			if (xmlhttp.readyState==4 && xmlhttp.status==200)
								    {
										var getJSON=xmlhttp.responseText;
									
										mtaJSON=jQuery.parseJSON(getJSON);
										
										
										for(var i=0;i<mtaJSON.videos.length-1;i++)
										{
											lengthInput = searchValue.length;
											lengthTitle = mtaJSON.videos[counter].title.length;
											
											if(lengthInput <= lengthTitle)
											{
												compare(searchValue, mtaJSON.videos[counter].title);
											}
											
											function compare(lowLength, highLength)
											{
												
												var searching = highLength.toLowerCase().search(lowLength.toLowerCase());
												
												if(searching != -1)
												{

											//	document.getElementById("av").innerHTML+="<table><tr><td rowspan='2'><a href='' onclick='goVideoPlayer("+mtaJSON.videos[counter].video_id+")'><img src='image/"+mtaJSON.videos[counter].video_id+".jpg'  height='150px'></a></td><td  align='center'><a href='' onclick='goVideoPlayer("+mtaJSON.videos[counter].video_id+")'>"+mtaJSON.videos[counter].title+"</a></td></tr ><tr><td>"+mtaJSON.videos[counter].description+"</td></tr></table>";
												
												document.getElementById("av").innerHTML+="<div class='videolistitem'> <table ><tr><td class='tdimage'> <div class='videolistitemimage'><a href='' onclick='goVideoPlayer("+mtaJSON.videos[counter].video_id+")'><img src='image/"+mtaJSON.videos[counter].video_id+".jpg'  height='150px' width='107px'></a> </div> </td><td><div class='videolistitemtext'>  <div class='videolistitemtitle'><a href='' onclick='goVideoPlayer("+mtaJSON.videos[counter].video_id+")'>"+mtaJSON.videos[counter].title+"</a></div>  <div class='videolistitemdesc'>"+trimByWord(mtaJSON.videos[counter].description)+"</div> </div></td></tr></table> </div>";

												}

											}
											
											//if(mtaJSON.videos[counter].title.toLowerCase() == searchValue.toLowerCase())
											//{
											//	document.getElementById("av").innerHTML+="<a href=''><img src='image/"+mtaJSON.videos[counter].video_id+".jpg'></a>"+mtaJSON.videos[counter].title+ "<br />";
											//}
											
											
											if(i <= (mtaJSON.videos.length-2))
											{
												counter++;
											}
										}//get video id
								  	}
								}		    
							}
						);
					}
				</script>
			</div>
		</div>    
	</body>
</html>
