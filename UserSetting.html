<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>MTA User Setting</title>
		<link rel="stylesheet" href="themes/Black_MC.min.css" />
		<link rel="stylesheet" href="themes/jquery.mobile.icons.min.css" />
		<link rel="stylesheet" href="jquerymobile/jquery.mobile.structure-1.4.2.min.css" />
        <link rel="stylesheet" href="css/tc_style.css" />
        <script src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
        <script src="js/jqm.page.params.js"></script> 
		<script src="jquerymobile/jquery-1.11.0.min.js"></script>
        <script src="jquerymobile/jquery.mobile-1.4.2.min.js"></script> 
        <script>
            function goTo(url)
            {
                window.location.href=url;
            }
            
            
            
            function isLoggedin()
            {
            	var c = window.localStorage['email'];
            	if(c == undefined)
            	{
            		window.localStorage['email'] = 'Guest';
            		window.localStorage['fullName'] = 'Guest';
            	}
            	
            	if(window.localStorage['email'] == 'Guest')
				{
					return false;
				}
				else
				{
					return true;
				}
            }
            
            
            function logout(url){
                 window.localStorage['email'] = "Guest";
                 window.localStorage['fullName'] = "Guest";
                 window.location ="videolist.html";
            }
        </script>
        <style>
		 table.detail {
			border-width: 1px;
			border-style: none;
			border-color: white;
			border-collapse: collapse;
			text-align: center;
		}
		table.detail th {
			border-width: 1px;
			padding: 1px;
			border-style: inset;
			border-color: white;
			-moz-border-radius: ;
		}
		table.detail td {
			border-width: 1px;
			padding: 1px;
			border-style: inset;
			border-color: orange;
			background-color: ;
			-moz-border-radius: ;
			padding-right: 10px;
			padding-left: 10px;
			width: 50%;
		}
		.tc_header
			{
				background: -webkit-gradient(linear,center top,center bottom,from(#999), to(#444));
			}
			.tc_footer
			{
				background: -webkit-gradient(linear,center top,center bottom,from(#999), to(#444));
			}
			#userData
			{
				color: orange;
				padding: 5px;
				background: -webkit-gradient(linear,center top,center bottom,from(#333), to(#001));
			}
        </style>
    </head>
    <body>
        <!--HEADER START -->
    	<div data-role="header" data-position="fixed" class="tc_header">
			<a href="" class="ui-btn ui-shadow ui-corner-all ui-icon-arrow-l ui-btn-icon-notext" onclick="goBack()"/></a> 
			<h1>User Setting</h1>
			<!-- <a href="UserSetting.html" class="ui-btn-right ui-btn ui-btn-inline ui-mini ui-corner-all ui-btn-icon-right ui-icon-gear">Options</a> -->
			<a href="#nav-panel" data-icon="bars" data-iconpos="notext">Menu</a>
      	</div>
        <div data-role="panel" data-position-fixed="true"  data-display="overlay" data-position="right"  data-theme="a" id="nav-panel" style="margin-top:44px;">
	        <ul data-role="listview">
	            <li data-icon="delete"><a href="#" data-rel="close" >Close Menu</a></li>
                <li><a onclick='logout("videolist.html")'>Logout</a></li>
	            <hr />
	            <li><a onclick="window.location.href ='sortlist.html'">Search</a></li>
	            <li><a onclick="window.location.href ='videolist.html'">Video List</a></li>
				<li><a onclick="window.location.href ='AboutUs.html'">About Us</a></li>
				<li><a onclick="window.location.href ='FAQ.html'">FAQ</a></li>
				<li><a onclick="window.location.href ='Feedback.html'">Feedback</a></li>
	        </ul>
       </div><!-- /panel -->
        <!--HEADER END -->
    	<div>		
			<div>				
				<div data-position="inline">
					<div id="userData" align="center">
        			</div>
					<div data-role="collapsible" data-collapsed="false" data-theme="a" data-content-theme="a">
					    <h4>Avatar Selection</h4>
					    <table align="center">
						    <tr>
						    	<td rowspan="2"><div id="displayAv"><img src='image/defaultavatar.jpg' height='92px' width='92px' /></div></td>
						    	<td>
						    		<div data-role="collapsible" data-collapsed="true" data-icon="none" data-theme="a" data-content-theme="a">
					    				<h4>Select Avatar</h4>
					    				<a onClick="av(1)"><img src='image/Avatar/av1.png' height='40px' width='40px' /></a>
					    				<a onClick="av(2)"><img src='image/Avatar/av2.png' height='40px' width='40px' /></a>
					    				<a onClick="av(3)"><img src='image/Avatar/av3.png' height='40px' width='40px' /></a><br />
					    				<a onClick="av(4)"><img src='image/Avatar/av4.png' height='40px' width='40px' /></a>
					    				<a onClick="av(5)"><img src='image/Avatar/av5.png' height='40px' width='40px' /></a>
					    				<a onClick="av(6)"><img src='image/Avatar/av6.png' height='40px' width='40px' /></a><br />
					    				<a onClick="av(7)"><img src='image/Avatar/av7.png' height='40px' width='40px' /></a>
					    				<a onClick="av(8)"><img src='image/Avatar/av8.png' height='40px' width='40px' /></a>
					    				<a onClick="av(9)"><img src='image/Avatar/av9.png' height='40px' width='40px' /></a>		
						    		</div>
						    	</td>
						  	</tr>
						  	<tr>
						  		<td><input id="btnSaveAv" type="button" value="Save Avatar"/></td>
						  	</tr>
					  	</table>
					</div>
					<div data-role="collapsible" data-collapsed="false" data-theme="a" data-content-theme="a">
					    <h4>Detail</h4>
					    <table class="detail" align="center">
					    	<tr style="background-color: black;">
					    		<td style="color: orange;">Full Name</td>
					    		<td style="color: orange;">Email</td>
					    	</tr>
					    	<tr style="background-color: none;">
					    		<td><p id="lblFullName" style="color: white;"></p></td>
					    		<td><p id="lblEmail" style="color: white;"></p></td>
					    	</tr>
					    </table>
					</div>
					<div data-role="collapsible" data-theme="a" data-content-theme="a" data-collapsed="false">
						<h4>Change Password</h4>
						<form id="formChangePassword">
							<input id="pwd" type="password" placeholder="Password" onfocus="clearThis(this)">
							<input id="retypePwd" type="password" placeholder="Re-type Password" onfocus="clearThis(this)">
							<input id="btnSavePassword" type="button" value="Save Password"/> <!-- value doesn't show up -->
							
							<!-- MESSAGE START -->
			                <div data-role="popup" id="popupBasic">
			                    <p>Your password doesn't match, please retype it.<p>
			                </div>
			                <div data-role="popup" id="nullpassword">
			                    <p>Please type your password.<p>
			                </div>
			                <div data-role="popup" id="pwcs">
			                    <p>Password Change Successfully!<p>
			                </div>
			                <div data-role="popup" id="awcs">
			                    <p>Avatar Change Successfully!<p>
			                </div>
			                 <!-- MESSAGE END -->
						</form> 
					</div>
					<!-- LOGOUT START
            		<div>
		                <h1></h1>
						<hr />
		                <form>
		                    <input type="button" value="Logout" onClick="goTo('videolist.html')">
		                </form>
            		</div> LOGOUT END-->

				</div>
				<script>

				  document.getElementById('userData').innerHTML = 'User: ' + window.localStorage['email'];
				
				  document.getElementById('lblFullName').innerHTML = window.localStorage['fullName'];
				  document.getElementById('lblEmail').innerHTML = window.localStorage['email'];
				  
	    	 	  var em = window.localStorage['email'];
	    	 		    	 	  
	    	 	  var mtaJSONAvatar;
	    	 	  var selectedAv = "defaultavatar.jpg";
	    	 	  $(document).ready(function(){
		      
				  	  var xmlhttpAvatar;
					  if (window.XMLHttpRequest)
					  {// code for IE7+, Firefox, Chrome, Opera, Safari
					     xmlhttpAvatar=new XMLHttpRequest();
					  }
					  else
					  {// code for IE6, IE5
					  	xmlhttpAvatar=new ActiveXObject("Microsoft.XMLHTTP");
					  }
					  
						xmlhttpAvatar.open("GET","http://remoteriver.eicp.net/trailercollection/userinfo.php",true);
						xmlhttpAvatar.send();
						xmlhttpAvatar.onreadystatechange=function()
						{
							if (xmlhttpAvatar.readyState==4 && xmlhttpAvatar.status==200)
						    {
								var getJSON=xmlhttpAvatar.responseText;
								
								mtaJSONAvatar=jQuery.parseJSON(getJSON);
						  	}
							for(var a = 0;a < mtaJSONAvatar.users.length-1;a++)
							{
								
								if(em == mtaJSONAvatar.users[a].email)
								{
									selectedAv = mtaJSONAvatar.users[a].avatar;
									break;
								}
							} 
							document.getElementById('displayAv').innerHTML = "<img src='image/Avatar/"+selectedAv+"' height='92px' width='92px' />";
						}
		            });

	    	 	  
				  $(document).ready(function(){
		           	  $("#btnSavePassword").click(function(){
		           	  	var x=document.forms["formChangePassword"]["pwd"].value;
		                var y=document.forms["formChangePassword"]["retypePwd"].value;
						var xmlhttp;
						if(x==null || x=="")
		                {
		                    $( "#nullpassword" ).popup( "open" );
		                    return false;
		                }
		                if(x!=y)
		                {
		                    $( "#popupBasic" ).popup( "open" );
		                    return false;
		                }
					  
					  if (window.XMLHttpRequest)
					  {// code for IE7+, Firefox, Chrome, Opera, Safari
					     xmlhttp=new XMLHttpRequest();
					  }
					  else
					  {// code for IE6, IE5
					  	xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
					  }
					  
					  xmlhttp.open("POST","http://remoteriver.eicp.net/trailercollection/ChangePassword.php",true);
					  xmlhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");
					  xmlhttp.send("email="+em+"&password="+$('#pwd').val());
					
					   xmlhttp.onreadystatechange=function()
					   {
					  		if (xmlhttp.readyState==4 && xmlhttp.status==200)
					    	{
					    		 $( "#pwcs" ).popup( "open" );
					    	}
					  	}
						});
						
		            });
					
					function av(avNum)
					{
						
						selectedAv = "av"+avNum+".png";
						document.getElementById('displayAv').innerHTML = "<img src='image/Avatar/"+selectedAv+"' height='92px' width='92px' />";
					}
					
	
		            
		            $(document).ready(function(){
		           	  $("#btnSaveAv").click(function(){
		           	  	var xmlhttp;
		           	  	if (window.XMLHttpRequest)
						{// code for IE7+, Firefox, Chrome, Opera, Safari
						   xmlhttp=new XMLHttpRequest();
						}
						else
						{// code for IE6, IE5
						   xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
						}
		           	  	
						xmlhttp.open("POST","http://remoteriver.eicp.net/trailercollection/ChangeAvatar.php",true);
					    xmlhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");
					    xmlhttp.send("email="+em+"&avatar="+selectedAv);
						xmlhttp.onreadystatechange=function()
					    {
					  		if (xmlhttp.readyState==4 && xmlhttp.status==200)
					    	{
					    		 $( "#awcs" ).popup( "open" );
					    	}
					  	}
						});
		            });
					
					function clearThis(target)
					{
						target.value= "";
					}
					
					function goTo(baseUrl)
					{
						window.location = baseUrl;
					}
					
				    function goBack()
					{
					  window.history.back()
					}
				</script>
			</div>
		</div>
    </body>
</html>
